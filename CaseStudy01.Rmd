---
title: "Case Study 1"
author: "Brook Andreas, Nicol Henderson Kuns, Selwyn Samuel, DJ"
date: "June 17, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```
Introduction about the project 

### This project is analytical study of beer and breweries distribution across the united states and their corresponding alcholic content and bittterness level 

##End Client : Zamy pharmaceutical

### Zamy pharmaceutical is working on a project in designing hangover pills targeting after beer headaches and mood swings and wanted to study the alcohol content of beers sold in the united states, the chemical metrics of bitterness and alcohol content and target what threshold of alcohol content can be subdued by the supposed after beer pill. It's a preliminary study used as an input of zany's chemists to design multi layer and multiple dose pills depending on average alcohol consumption and mean distribution.

The study team was given a set of data about the beers and the breweries. As part of the analysis the team studied the data from various angles to provide valuable insight into the data.


```{r }
library(repmis)
library(RCurl)
library(knitr)

#
# Read the Beers & Breweries CSV files from the github URL. We use the RAW URL to read the CSV file's content properly.
# After reading the file, run a few funcstions to check the structure and data content to verify if we read the files 
# properly.
#
# Originally we downloaded the file to the local directory but later with the help of Prof. Santerre we were able to 
# read the raw files directly from the github URL. The original code to download to local directory is commented out.
# 
site <- "https://raw.githubusercontent.com/selwyn-samuel-smu/CaseStudy01/master/Beers.csv"
#download.file(site,destfile ="./Beers.csv ") - Selwyn - Commented the code as we do not need to download to local disk
Beers <- read.csv(site)
#list.files() - Selwyn - Commented the code as we do not need to download the file to local disk
str(Beers)
dim(Beers)
names(Beers)


site2 <- "https://raw.githubusercontent.com/selwyn-samuel-smu/CaseStudy01/master/Breweries.csv"
#download.file(site,destfile ="./Breweries.csv ") - Selwyn - Commented the code as we do not need to download the file to local disk
Breweries<- read.csv(site2)
#list.files() - Selwyn - Commented the code as we do not need to download the file to local disk

str(Breweries)
dim(Breweries)
names(Breweries)
```
$~$

```{r}

#
# Clean up the data
#
# 1. The State codes have a space in the front. We can remove it.
#
Breweries$State <- trimws(Breweries$State)

#
# 2. Add State Name to the data frame. The one with NA is Washington DC
#
Breweries$StateName <- state.name[match(as.character(Breweries$State), state.abb)]
Breweries$StateName[Breweries$State == "DC"] <- "Washington DC"

```

###Question: 1. How many breweries are present in each state?

One of the first tasks for the team is to analyze the distribution of Breweries across various states in the US. The data contained information about all 50 states and also Washington DC. The following table shows the number of breweries by state arranged by alphabetical order of the state names.

```{r}

#
# We use the table function to let R do most of the work for us.
# We coerce the result to a dataframe so that we can get a prettier print by state. We added column names for the result.
#

Brewery_count <- as.data.frame(table((Breweries$StateName)))
names(Brewery_count) <- c("State", "Number of Breweries")

#
# Print the breweries by State 
#
kable(Brewery_count, format="html", caption="Breweries count by State")

```

$~$

###Question: 2. Merge beer data with the breweries data. Print the first 6 observations and the last six observations to check the merged file.

One of the challenges the team faced was the data about the Beers and Breweries were available in two separate files. Upon further analyzing the two files, the team found out that there was a common column that connected both the files. In the Beers file, there was a column "Brewery_id" that matched up with the "Brew_ID" column in the Breweries file. 

The team decided to merge both the files to provide a single file that can be useful in viewing the Beers and the corresponding Breweries in the same data.

```{r}

#
# Use the merge function with the Brewery_id and Brew_ID
#

#Merged_file <-merge(Beers, Breweries, by="row.names", all.x=TRUE) - Code replaced with merging the IDs

Beers.Breweries <- merge(Beers, Breweries, by.x = 'Brewery_id', by.y = 'Brew_ID')

#Change the column names
names(Beers.Breweries) <- c("Brewery_id", "Beer", "Beer_ID", "ABV", "IBU", "Style", "Ounces", "Brewery", "City", "State", "State Name")

# Print the dimensions of the merged data
dim(Beers.Breweries)

#Print the first 6 records
kable(head(Beers.Breweries))

#Print the last 6 records
kable(tail(Beers.Breweries))

## This code will print the first 6 and last 6 elements of the data set 
#Breweries$Brew_ID
#table(Beers$Brewery_id)
#sort(table(Beers$Brewery_id))
## The code above compares the same coloumn ID with different header names 
```


### Report the number of NA's in each column.
```{r}
sapply(X = Breweries, FUN = function(x) sum(is.na(x)))
apply(Breweries, 2, function(x) length(which(is.na(x))))

sapply(X = Beers, FUN = function(x) sum(is.na(x)))
apply(Beers, 2, function(x) length(which(is.na(x))))
```
### The above  code uses the input data as a data frame and creates a function using sapply or apply aggregates and create a count of each coloumn that involves is.na=true. we can also count the non NA value by applying !is.na(x).adding the is.na and !is.na  should give the same values of dim(Breweries) or dim(Beers) coloumn count.
```{r}
apply(Beers, 2, function(x) length(which(is.na(x))))
apply(Beers, 2, function(x) length(which(!is.na(x))))
a <- apply(Beers, 2, function(x) length(which(is.na(x))))
b <-apply(Beers, 2, function(x) length(which(!is.na(x))))
a+b
dim(Beers)
```
```{r}
# calculates the median alchool content across all beer brands
median(Beers$ABV,na.rm = TRUE)

# calculates the median international bitterness unit for each state
median(Beers$IBU,na.rm = TRUE)


```
###
Compute the median alcohol content and international
bitterness unit for each state. Plot a bar chart to compare.

```{r}
library(scatterplot3d) # Selwyn - Added library

plot(Beers$IBU,Beers$ABV,main="Beer Alcohol Content and Bitterness level contrast",col="blue", xlim=c(0,150),ylim = c(0,0.13))

scatterplot3d(Beers$Beer_ID, Beers$ABV,Beers$IBU,main="Beer Alcohol Content and Bitterness level contrast",xlab = "Beer_ID", xlim =c(0,2500),ylab = "ABV",ylim=c(0,0.13),zlab = "IBU " ,angle = 55,pch = 16, color="steelblue")

length(Beers$Beer_ID[!is.na(Beers$Beer_ID)])

```
### Which state has the maximum alcoholic (ABV) beer? Which
state has the most bitter (IBU) beer?

```{r}
max(Beers$ABV,na.rm = TRUE)
min(Beers$ABV,na.rm = TRUE)

max(Beers$IBU,na.rm = TRUE)
min(Beers$IBU,na.rm = TRUE)
```
### using indexing in r or using SQL library  
```{r}

names(Beers)
names(Breweries)
Beers$Beer_ID
Beers$Brewery_id
Breweries$Brew_ID
### Hence based on the vector comparison the coloumn names Brewery_ID and Brew_ID are the common coloumns where the data frame merge or join is done

library(sqldf)
sqldf("SELECT MAX(ABV)from Beers")
sqldf("SELECT Name, Brewery_id FROM Beers WHERE ABV=0.128")
sqldf("SELECT State FROM Breweries WHERE Brew_id=52")
## or we can use nested SQL indexing 
sqldf("SELECT State FROM Breweries WHERE Brew_id=(SELECT Brewery_id FROM Beers WHERE ABV=(SELECT MAX(ABV)from Beers))")
## Hence the state with higher alcohol beer is Colorado

## To calculate the state with the state with the most bitter beer 
max(Beers$IBU,na.rm = TRUE)
library(sqldf)
sqldf("SELECT MAX(IBU)from Beers")
sqldf("SELECT Name, Brewery_id FROM Beers WHERE IBU=138")
sqldf("SELECT State FROM Breweries WHERE Brew_id=375")
## or we can use nested SQL indexing 
sqldf("SELECT State FROM Breweries WHERE Brew_id=(SELECT Brewery_id FROM Beers WHERE IBU=(SELECT MAX(IBU)from Beers))")
## Hence based on the analysis Oregon has the most bitter Beer
```

###Summary statistics for the ABV variable.
```{r}
library(pastecs)
#stat.desc(Beers$ABV,BASIC=F) -Selwyn (Removed BASIC=F as it was giving an error "Unused argument")
stat.desc(Beers$ABV)
```
### Is there an apparent relationship between the bitterness of the
beer and its alcoholic content? Draw a scatter plot.

```{r}
plot(Beers$IBU,Beers$ABV,main="Beer Alcohol Content and Bitterness level contrast",col="blue",xlab="IBU", ylab="Alcholic Content per bottle", xlim=c(0,150),ylim = c(0,0.13))

library(ggplot2)
## Reference https://www.craftbeer.com/craft-beer-muses/craft-beer-by-the-numbers
## It looks like there are other confounding varriables ,that can give a complete picture and I dont see a direct correlation between IBU and AbV
```

### The Beers dataset contains a list of 2410 US craft beers and Breweries dataset contains 558 US breweries. The datasets descriptions are as follows.

###Beers.csv:Attributes

####Name: Name of the beer.
####Beer_ID: Unique identifier of the beer.
####ABV: Alcohol by volume of the beer.
####IBU: International Bitterness Units of the beer.
####Brewery_ID: Brewery id associated with the beer.
####Style: Style of the beer.
####Ounces: Ounces of beer.

###Breweries.csv:Attributes

####Brew_ID: Unique identifier of the brewery.
####Name: Name of the brewery.
####City: City where the brewery is located.
####State: U.S. State where the brewery is located.
